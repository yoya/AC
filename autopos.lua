---
--- Position
--- 位置関係の関数郡

local M = {}

local utils = require 'autoutils'
local printChat = utils.printChat
local array_reverse = utils.array_reverse
local pushKeys = utils.pushKeys
local turnToFront = utils.turnToFront
local aczone = require 'zone'

local automoveRouteTable = {
    [6] = {  -- 熊爪獄
        wind = { -- Wind Pillar
            {x=-679.8, y=-540, z=18.5}, {x=-694.8,y=-537},
            {x=-700,y=-518.6}, {x=-701.5,y=-496.2}, {x=-701,y=-482.5},
            {x=-702.1,y=-461.6}, {x=-717.5,y=-443}
        }
    },
    [15] = { -- アビセア、コンシュタット
        conf = {
            {x=154.5,y=-840,z=-72}, {x=130.4,y=-826},
            {x=131,y=-825.5}, {a="f8touch"}
        }

    },
    [45] = { -- アビセア、タロンギ
        conf = {
            {x=-23.1,y=-677.4,z=44.3}, {x=-1.7,y=-678.4},
            {x=0,y=-680.3}, {a="f8touch"}
        }
    },
    [51] = { --- ワジャーム樹林
        pec = { --- 珍妙なモンスター
            {x=100,y=-163,z=-12}, {x=87.7,y=-256.6},  {a="mount"},
            {x=25.3,y=-264.9}, {x=-25.5,y=-294.5},
            {x=-55.9,y=-348.4}, {x=-63.3,y=-457.9},
            {x=-97,y=-463.2}, {x=-98.3,y=-542.2},
            {x=-52.6,y=-610.1}, {x=-57,y=-648.8},
        }
    },
    [54] = { -- アラパゴ暗礁域
        pec = { -- 珍妙なモンスター
            {x=-560,y=379.6,z=-7.7},{x=-537,y=382}, {a="mount"},
            {x=-534.2,y=377.1}, {x=-544.8,y=346.2},
            {x=-544.2,y=339}, {x=-535.6,y=338.7},
            {x=-475.3,y=338.4}, {x=-466.3,y=338.4},
            {x=-455.9,y=341.4}, {x=-441.4, y=342.5},
            {x=-419,y=344.6}, {x=-393.4,y=333.1,z=-3.5}
        }
    },
    [70] = { -- チョコボサーキット
        ent = {
            {x=-320,y=-475,z=-0.3}, {x=-326.1,y=-463.9},
            {x=-327.1,y=-456.2}, {x=-329.1,y=-453.5},
            {x=-330.4,y=-412.9}, {a="f8touch"}, {a="wait"},
            {a="wait"},{a="up"}, {a="wait"}, {a="enter"}
        }
    },
    [79] = { --- カダーバの沼
        pec = { ---　珍妙なモンスター
            {x=660,y=239.5,z=-4}, {x=652,y=260},
            {a="mount"}, {x=657.6,y=282.9},
            {x=687,y=326.2}, {x=709.7,y=357.8},
            {x=728,y=384.6}, {x=720.6,y=449.4},
            {x=732.6,y=477.1}, {x=734.4,y=519.5},
            {x=749,y=537.2}, {x=776.4,y=539.6},
            {x=787.4,y=644.6}, {a="dismount"}
        }
    },
    [84] = { -- 過去バタリア
        rola = { -- 扉から過去ロランベリー
            {x=-51.5,y=437,z=0.4}, {x=-50,y=430},
            {a="mount"}, {x=-33.6,y=299.4}, -- 山の上
            {x=-6.9,y=226.8}, {x=2.5,y=224.7},
            {x=132.4,y=209}, {x=162.4,y=170.6},
            {x=244.7,y=44.9},
            {x=325.5,y=-115}, {x=331.7,y=-123.6},
            {x=324.6,y=-190.9}, {x=320,y=-197.3},
            {x=337.7,y=-221},
--            {x=397.5,y=-206.7}, {x=396.6,y=-209.9},
--            {x=381.7,y=-212.4}, {x=381.8,y=-215.5},
--            {x=393.4,y=-217, z=-1}, {x=391.8,y=-222.1, z=-1},
--            {x=391.7,y=-225.2,z=8.3},
--            {x=391.5,y=-261.3}, {x=396.4,y=-267.5},
            {x=390.4,y=-262.4}, {x=396.4,y=-266.9},
            {x=461.2,y=-336.1}, {x=463.1,y=-339.1}, {}
        }
    },
    [85] = { -- ラヴォール村
        gate = { -- Reinforced Gateway 
            {x=231,y=20,z=-0}, {x=224.2,y=11.5},
            {x=214.5,y=-15.4}, {a="f8touch"},
            {x=214,y=-21.6}, {a="insne"},
            {x=220.6,y=-52.7},
            {x=216.3,y=-68}, {x=201,y=-69}, {x=182.1,y=-73},
            {x=152.4,y=-71.7}, {x=140.6,y=-61.3}, {x=139.5,y=-48.9},
            {x=140.2,y=-38.9}, {x=136.2,y=-23.7}, {x=132.1,y=-20.5},
            {x=114.3,y=-17.1}, {x=101.6,y=-12.5}, {x=70.1,y=-18.8},
            --- ここが北の橋
            {x=48.2,y=-19}, {x=13.7,y=-25.7}, {x=-0.5,y=-21},
            {x=-16.6,y=-17.8}, {x=-19.2,y=-8}, {x=-20.9,y=43.2},
            {x=-28.2,y=55.7}, {x=-32.9,y=59.1},
            --- ここから細い道
            {x=-87.2,y=61.3}, {x=-92.7,y=64.6}, {x=-107.1,y=95.2},
            {x=-114.2,y=99.4}, {x=-130,y=95.8}, {x=-137,y=90.7},
            {x=-140,y=82.8}, {x=-141.3,y=71.1}, {x=-153.3,y=62},
            {x=-172.6,y=58.9}, {x=-193.3,y=59.7}, {x=-212.8,y=54.9},
            {x=-218.5,y=45.4}, {x=-215.7,y=28.2}, {x=-225.1,y=-25.5},
            {x=-218.5,y=-45.2}, {x=-212.3,y=-54.9}, {x=-174.2,y=-65.4},
            {x=-154.7,y=-60.4}, {x=-148.4,y=-63.7}, {x=-135.9,y=-88.6},
            {x=-130.9,y=-97.5}, {x=-107.9,y=-100.5}, {x=-99.3,y=-128.2},
            --- ここも橋
            {x=-99.1,y=-149.5}, {x=-102.1,y=-171.6}, {x=-102.3,y=-180},
            {x=-109,y=-179.9}, {a="rmstatus"},
            {x=-110.2,y=-179.9}, {a="f8touch"}
       },
    },
    [91] = { -- 過去ロランベリー耕地
        sauro = { -- 過去扉からソロムグへ
            {x=-196.5,y=361.2,z=8}, {x=-190,y=360},
            {a="mount"}, {x=-43.5,y=335.1,z=15.6},
            {x=180.4,y=427.5,z=24.8}, {x=197.5,y=442,z=24.2},
            {x=282.9,y=450.2,z=20.7}, {x=334.6,y=461.8,z=23.4},
            {x=350.5, y=468.5,z=24.2}, {},
        },
        bata2sauro = { -- 過去バタリアから過去ソロムグ
            {x=-33.5,y=610.5,z=23.8}, 
            {x=47.5,y=549}, {x=51.9,y=545.5},
            {x=127,y=458},
            {x=185.4,y=432.2}, {x=191.1,y=439.4},
            {x=198.7,y=442.1}, {x=281.4,y=445.9},
            {x=330.3,y=459.3}, {x=337.3,y=463.2},
            {x=349.7,y=468.6,z=24.2}, {}
        },
    },
    [98]= { -- 過去ソルムグ
        jueno = {
            {x=-454.8,y=207.2,z=-0}, {x=-413.5,y=224,z=-0},
            {x=-405,y=291.8,z=0.2}, {x=-442.6,y=339.1,z=1},
        },
    },
    [102] = { -- ラテーヌ草原
        --　テレポホラ
        shat = {
            {x=420,y=20,z=19.1}, {x=400,y=16}, {a="mount"},
             {x=373.3,y=10.6}, {x=351,y=-9.7}, {x=316.5,y=-58.1},  {a="dismount"},
            {x=336.8,y=-59.7}, {a="f8touch"}
        },
        dim = {
            {x=420,y=20,z=19.1}, {a="mount"},
            {x=373.3,y=10.6}, {x=351,y=-9.7},
            {x=316.5,y=-58.1},{x=318,y=-64.5},
            {x=350,y=-107}, {x=368.8,y=-128},
            {x=417.2,y=-163.3}, {a="dismount"},
            {x=419.6,y=-143.6}, {a="f8touch"}
        },
        -- ホラリング
        circle = {
            {x=420,y=-150,z=19.5}, {x=416,y=-139},
            {a="mount"}, {x=372,y=-130}, {x=281,3,y=-79.7},
            {x=211.4,y=-46.7}, {x=147.4,y=-23.8},
            {x=102.8,y=-3.9}, {x=-18.4,y=55.8}, -- {x=-60.4,y=72.4},
            {x=-60.1,y=94.7}, {x=-136.9,y=175.7},
            {x=-175.1,y=245.7}, {a="dismount"},
            {x=-177.9,y=251}, {a="f8touch"}
        },
    },
    [104] = { -- ジャグナー森林
        e6carp = { -- ギルド桟橋 (Carpenter's Landing)
            {x=63,y=-13,z=0.4},
            {x=44,y=7,z=0.5}, {x=41,y=10,z=4.4},
            {x=7,y=52}, {x=-48,y=61}, {x=-73,y=97},
            {x=-132,y=101}, {x=-173,y=104}, {x=-209,y=130},
            {x=-248,y=156}, {x=-311,y=192}, {x=-345,y=223},
            {x=-378,y=274}, {x=-428,y=280}, {x=-452.7,y=284.8},
            {x=-464,y=301}, {x=-478,y=309}, {x=-489.7,y=320.3},
            {x=-512,y=329}, {x=-528,y=328}, {x=-535,y=335}, {}
        },
    },
    [105] = { -- バタリア丘陵
        pec = { --　珍妙なモンスター
            {x=486.3,y=-155.5}, {x=430,y=-146.4}, {a="mount"},
            {x=399.8,y=-124.6}, {x=335.1,y=-69.9},
            {x=234.2,y=70.5}, {a="dismount"}
        },
    },
    [111] = { -- ボスディン氷河
        pec = { --　珍妙なモンスター
            {x=279,y=536,z=20}, {x=291,y=507.5}, {a="mount"},
            {x=379,y=394.8}, {x=382.9,y=302.5}, {x=397.3,y=282.9},
            {a="dismount"}
        },
    },
    [112] = { -- ザルカバード
        -- テレポヴァズ
        uleg = { -- ウルガラン山脈へ
            {x=150.3,y=-37.3,z=-21},
            {x=153.3,y=-39.5}, {a="mount"},
            {x=146.4,y=-47.4,z=-16.1}, {x=137.1,y=-48.3,z=-16.4},
            {x=96.6,y=-32.2}, {x=60.1,y=8.1}, {x=25.3,y=52.4,z=-16.2},
            {x=20.3,y=67.4,z=-17.9}, {x=22.8,y=108.7,z=-25.9},
            {x=14.9,y=137.3,z=-33.2}, {x=6.8,y=135.5,z=-34.8},
            {x=-7,y=69.1,z=-36.2}, {x=-24.5,y=60.4}, {x=-50.9,y=60.1},
            {x=-70,y=62.4}, {x=-85.9,y=59.2}, {x=-98.4,y=60.1},
            {x=-130.7,y=51.5}, {x=-134.2,y=56.7}, {x=-136.5,y=100.9},
            {x=-141.1,y=112.8}, {x=-139.7,y=132.1}, {x=-134.7,y=136},
            {}
        },
    },
    [124] = { -- ヨアトル大森林
        -- ウガレピ寺院マップ１から
        granite = {
            {x=343,y=-224.3,z=-10},
            {x=333.1,y=-222.8}, {x=331,y=-220.8},
            {x=329,y=-208.7},
            {x=326.9,y=-196.6}, {x=324.9,y=-194.3},
            {x=312.9,y=-192},
            {x=300,y=-189.9}, {x=297.5,y=-187.2},
            {x=297.8,y=-172}, {x=303.8,y=-168},
            {x=343,y=-168}, {}
        }
    },
    [125] = { -- 西アルテパ砂漠
        pec = { --　珍妙なモンスター
            {x=91.3,y=-23.4}, {x=71,y=5}, {a="mount"},
            {x=52.4,y=32.7}, {x=-15.3,y=167.4}, {a="dismount"}
        },
    },
    [126] = { -- クフィム島
        -- HP#1
        pec = { --　珍妙なモンスター
            {x=-212,y=94,z=-21}, {x=-204,y=83.5},
            {x=-191.7,y=47.4}
        },
        pond = { -- 中央の池
            {x=-212,y=94,z=-21}, {x=-142,y=24},
            {x=-70,y=16}, {x=-61,y=17}, {x=-56,y=62},
            {x=-36,y=83}, {x=-10,y=85},
            -- {x=-4.5,y=99}, {x=-18,y=104},
        },
        hiero = { --デュミナス
            {r="pond"}, {x=7,y=117}, {x=19,y=148},
            {x=16,y=159}, {a="f8touch"}
        }
    },
    [132] = { -- アビセア、ラテーヌ
        conf = {
            {x=-480,y=792,z=0.2}, {x=-476,y=785.1},
            {x=-472.9,y=785.4}, {a="f8touch"}
        }
    },
    [139]= { --- ホルレー
        trove = {  -- AMAN トローブ
            {x=-316.3,y=-102.5}, {x=-346.8,y=-127},
            {x=-366,y=-121.7}, {x=-381,y=-98},
            {x=-392.9, y=-71.3},
        },
        trove2 = {  -- AMAN トローブ
            {x=-75.3,y=77.4}, {x=-107.26, y=52.38},
            {x=-131,y=64}, {x=-147,y=95},
            {x=-152.9,y=108.5}
        },
        trove3 = {  -- AMAN トローブ
            {x=163.6,y=257.2}, {x=133.2,y=232.6},
            {x=110.6,y=242.9}, {x=92.6,y=276.5}, {x=87.1,y=288.4}
        },
    },
    [142] = { -- ユグホトの岩屋
        -- 温泉から入ったところ
        horl = { -- ホルレー
            {x=437.6,y=68.1,z=-40.1},
            {x=429,y=64}, {x=426,y=67.5}, {x=421,y=92},
            {x=410,y=109},{x=405.5,y=125}, {x=403,y=130},
            {x=415,y=146}, {x=427,y=154}, {x=436,y=169},
            {x=440,y=171,z=-40}, {}
        },
    },
    [143] = { -- パルブロ鉱山
        pec = { --　珍妙なモンスター
            {x=108,y=-147,z=-38.5}, {x=94.7,y=-149,z=-36.7},
            {x=92,y=-142.8,z=-36.2}, {x=100.5,y=-131.6,z=-34.3},
            {x=100.1,y=-72.7,z=-32}, {x=91.9,y=-61.9,z=-32},
            {x=81.3,y=-60.6,z=-32},  {x=69.5,y=-61.9,z=-32},
            {x=62.9,y=-67.9,z=-32}, {x=57.5,y=-90.6,z=-32},
            {x=48.2,y=-98,z=-32}, {x=24.5,y=-104.3,z=-31.4},
        },
    },
    [147]= { --- ベドー
            dome = {
            {x=-264, y=106,z=1}, {x=-238.3,y=100,z=1},
            {x=-185.9,y=95.6,z=1}, {x=-177.9,y=138.9,z=1},
            {x=-121,y=135.7,z=1}, {x=-60.4,y=136.9,z=1}, 
            --- 洞窟
            {x=-62.6,y=83.7,z=4.1}, {x=-41.7,y=74.5,z=9.8},
            {x=-32.4,y=94,z=14.7}, {x=-52.1,y=100.7,z=19.5},
            {x=-61.6,y=78.9,z=24}, {x=-55.6,y=64.5,z=24},
            {x=-32,y=60.6,z=24},
         },
        mute1 = {
            {x=-264, y=106,z=1}, {x=-238.3,y=100,z=1},
            {x=-185.9,y=95.6,z=1}, {x=-177.9,y=138.9,z=1},
            {x=-121,y=135.7,z=1}, {x=-60.4,y=136.9,z=1}, 
            --- 洞窟
            {x=-62.6,y=83.7,z=4.1}, {x=-41.7,y=74.5,z=9.8},
            {x=-32.4,y=94,z=14.7}, {x=-52.1,y=100.7,z=19.5},
            {x=-61.6,y=78.9,z=24}, {x=-63,y=65.4,z=24},
            {x=-94,y=61,z=23.8}, {x=-101,y=102,z=24},
        },
        mute2 = {
            {x=-101,y=102,z=-24}, {x=-97,y=59,z=23.8},
            {x=-103.4,y=26.5,z=23.8}, {x=-135.5,y=18.9,z=24.2},
            {x=-140.8,y=48.3,z=24}, {x=-151.5,y=58.1,z=23.8},
            {x=-182.3,y=63.1,z=24}, {x=-215.3,y=55.5,z=24},
            {x=-221.2,y=33.2,z=22.6}, {x=-206.2,y=20.7,z=18.3},
            {x=-194.2,y=30.3,z=14}, {x=-200.4,y=40.7,z=11.6},
            {x=-218,y=40.3,z=5.7}, --- ←このへん、あやしい
            --- 地上
            {x=-221,y=29,z=2.2}, {x=-214.7,y=-64.2,z=1},
            {x=-174.6,y=-67.5,z=1}
        },
        dome = { -- mute2 から dome(伽藍)
            {x=-174.6,y=-67.5,z=1}, {x=-190.5,y=-101.7, z=1},
            --- 呪いの場所から
            {x=-223.4,y=-135.7,z=1}, {x=-259.8,y=-135.7,z=1},
            --- 上の段
            {x=-268.9,y=-128.8,z=-3},{x=-279.5,y=-168,z=-3.5},
            {x=-280.2,y=-201.4,z=-3.3}, {x=-268.3,y=-230.8,z=-3.7},
            {x=-212.6,y=-230.4,z=-3.6}, {x=-161.7,y=-218.7,z=-3.2},
            {x=-26,y=-181.9,z=-3}, {x=20,y=-142.3,z=-3},
            --- 右エリア
            {x=47.4,y=-119,z=-3}, {x=60,y=-78.4,z=-3},
            {x=56.5,y=-48.5,z=-3}, {x=49.4,y=-28.9,z=-3.7},
            {x=37,y=25.5,z=-3.1}, {x=41.8,y=45.3,z=-3.3},
            {x=47.5,y=127.2,z=-3}, {x=94.8,y=210.2,z=-3},
            {x=147.6,y=189.4,z=-4},
            --- 下り坂
            {x=179,y=141.1,z=1}, {x=183.2,y=156.24, z=4},
            {x=165.8,y=164.8,z=9.2}, {x=151.8,y=151.3,z=13.6},
            {x=166.6, y=139,z=18.2}, {x=177.4,y=150.9,z=22.4},
            {x=184.9,y=176.6,z=29.4}, {x=211.9,y=179.3,z=35.8},
            {x=222,y=160.8,z=39.9}, {x=225.1,y=141.2,z=39.8},
            --- 呪いの場所から
            {x=260.3,y=137.6,z=40.1}, {x=330.9,y=138.2,z=30.3}, {x=339.2,y=124.6,z=24.8},
            --- もう一つの呪から
            {x=343.2,y=102.3,z=24.2}, {x=378.9,y=98.8,z=24.8},
            --- 更にもう一つの呪から坂を下る
            {x=381.7,y=63.2,z=24}, {x=418.5,y=54,z=29.5},
            {x=416.7,y=23,z=36.6}, {x=384,y=18,z=40},
        }
    },
    [148]= { --- ベドー伽藍
        mino1 = { {x=2.9, y=60.5}, {x=56,y=57.3}, {x=58.1,y=49.4},
            {x=61.7,y=22}, {x=60.2,y=-4.4},
        },
        mino2 = { -- ミノ石
            {x=60.2,y=-10.6}, {x=37.6,y=-41.5},
            {x=25.2,y=-54.4}, {x=19.9,y=-69.7},
            {x=11.2,y=-81.2},
        },
    },
    [149]= { --- ダボイ
    cave1 = { -- 洞窟１（北）
        {x=222,y=-10}, {x=215.7,y=-25.5},
     {x=224.2,y=-85.3}, {x=152,y=-71.6},
     {x=142.3,y=-60.5}, {x=134,y=-19.5},
     {x=97.5,y=-16.3}, {x=-20.6,y=-22.9},
        {x=-21.5,y=-66.7},
    },
    cave2 = { -- 洞窟２（南）
        {x=222,y=-10}, {x=215.7,y=-25.5},
        {x=224.2,y=-85.3}, {x=231.5,y=-110.5},
        --- 南東への通路
        {x=219,y=-150}, {x=223.4,y=-174.9}, {x=264.9,y=-182.5},
       --- 南東の広場
        {x=270.1,y=-193.3},
        {x=278,y=-219.7},
        {x=288,y=-285}, {x=252.7,y=-301.2},
         --- 南の通路
        {x=244.9,y=-299.8},{x=221.8,y=-306},{x=216.6,y=-307.3},
        {x=218.2,y=-269.3}, {x=195,y=-255.7},{x=121.3,y=-260.2},
        {x=52,y=-255.7}, {x=66.3,y=-300}, {x=56.3,y=-349.4},
        {x=56.5,y=-363},
        },
        taru = { --- オーブのタル魔道士
        {x=92.8,y=-159}, {x=79.9,y=-146.6},
        --- 橋
        {x=80.2,y=-140.2}, {x=129.9,y=-139.8},
        --- 真ん中の島
        {x=146.5,y=-174.7},  {x=176.7,y=-173.5}, 
        --- ここまでオーブバリアと胸痛
        --- 橋をわたってタルへ
        {x=179.7,y=-142.9}, {x=177.4,y=-120}, {x=186.4,y=-116.92},
        },
        cave3 = {  --- 真紅のオーブ入口
        {x=92.8,y=-159}, {x=79.9,y=-146.6},
        --- 橋
        {x=80.2,y=-140.2}, {x=129.9,y=-139.8},
        --- 真ん中の島
        {x=146.5,y=-174.7}, {x=176.7,y=-173.5}, 
        --- taruと共通
        {x=180.3,y=-218.8},
        },
        orb4 = { -- オーブ４つ目（南）本ワープから向かう
        {x=222,y=-10}, {x=215.7,y=-25.5},
        {x=224.2,y=-85.3}, {x=231.5,y=-110.5},
        --- 南東への通路
        {x=219,y=-150}, {x=223.4,y=-174.9}, {x=264.9,y=-182.5},
       --- 南東の広場
        {x=270.1,y=-193.3},
        {x=278,y=-219.7},
        {x=288,y=-285}, {x=252.7,y=-301.2},
         --- 南の通路
        {x=244.9,y=-299.8},{x=221.8,y=-306},{x=216.6,y=-307.3},
        {x=218.2,y=-269.3}, {x=195,y=-255.7},{x=121.3,y=-260.2},
        {x=52,y=-255.7}, {x=66.3,y=-300}, {x=21.6,y=-298.2},
        {x=22,y=-259.2}
    },
    },
    [150] = { --- 修道窟
        meno = {   -- メノ石
            {x=-43.8,y=-100.9}, {x=-65.4,y=-96.7}, {x=-96.9,y=-102.2},
            {x=-119.2,y=-97.7}, {x=-138,y=-102.4}, {x=-142,y=-69.3},
            {x=-156.7,y=-28.7}, {x=-160.9,y=5.7},
        },
        forward = {
            {x=37.3,y=-380.4}, {x=26.5,y=-377.7}, {x=-19,y=-380},
            {x=-22.3,y=-315.8},
            ---狭いところ
            {x=-13.7,y=-268.4},{x=-34.9,y=-259.8},{x=-58,y=-261.6},
            {x=-61.3,y=-236.9}, {x=-57.7,y=-218.2},{x=-62.1,y=-184},
            --左上から真ん中
            {x=-60,y=-140.5},{x=21.2,y=-138.5},
            --- 最後ののぼり坂
            {x=19.5, y=-175.4}, {x=25.4,y=-180},
            {x=62.9,y=-177.5}, {x=80, y=-181}
        },
    },    
    [151]= { --- オズトロヤ城
        door1 = { -- 落ちるドア
            {x=-221,y=-14}, {x=-185.9,y=-19}, {x=-178.5,y=19.9},
            {x=-29,y=21.8}, {x=-20.6,y=7.8}, {x=-19,y=-15.4},
            {x=14.5,y=-18.9}, 
        },
        torch = { -- torch(三国ミッション)
            {x=19.9,y=-6.1}, {x=21.5,y=19.5}, {x=99.3,y=19.5},
            {x=100,y=-19.8}, {x=21.6,y=-19.5},  -- ここまで共通
            {x=14.3,y=56.31},{x=-96.3,y=58}, {x=-102.7,y=30.2},
            {x=-179,y=20}, {x=-174.7,y=54.6}, {x=-144.2,y=65.8},
            {x=-144.2,y=97.3},
            --- 内庭２階
            {x=-171.4,y=103.9}, {x=-177,y=216},
            --- 階段
            {x=-100.5,y=220.1}, {x=-98.2,y=142,z=4},
---            {x=-101,y=222.2,z=12},
            {x=-62.4,y=137.9,z=12},
            --- 階段降りきったとこ
            {x=-60,y=25.2,z=24.3}, --- もう少しおく？
            {x=-175,y=14,z=24.3},
            {}, {x=-177.8,y=-95.3,z=24.3},
            {x=-100.6,y=-103.6,z=24.3},{x=-97.9,y=-106.9,z=24.3},
        },
        door2 = { -- ４つレバーのドア(限界とウィンダスM)
           {x=19.9,y=-6.1}, {x=21.5,y=19.5}, {x=99.3,y=19.5},
            {x=100,y=-19.8}, {x=21.6,y=-19.5},  -- ここまで共通
            {x=17.1,y=-57.4}, {x=-17.9,y=-62.2},
            {x=-21.9,y=-98.3}, {x=-57,y=-102.7},
            -- 下の方
            {x=-63.6,y=-137}, {x=-93.6,y=-136.7},
            {x=-107,y=-99}, {x=-135.8,y=-97.6}, 
            {x=-141.4,y=-77.4,z=-15.8},  -- 引っかかるので追加
            {x=-134,y=-70.8}, {x=-60.6,y=-58.2},
            {x=-61.8,y=-29.5}, {x=-101.3,y=-22.3}, {x=-182.3,y=-19.9},
        },
        door3 = {
            {x=-188,y=-20}, {x=-257,y=-20.5,Z=-15.8},
            --- 階段途中
            {x=-258.8,y=-59.9, z=-20}, {x=-146.4,y=-60.7,z=-39.8},
            {x=-133.9,y=-22,z=-39.8}, {x=-100.9,y=-24,z=-39.8},
            ---池
            {x=-98.8,y=-90.7,z=-38.8}, {x=-61.5,y=-109.6,z=-39.8},
            {x=-57.9,y=-135.3,z=-39.8},
            {x=-24,y=-146.8,z=-39.8}, 
           {x=-24.7,y=-179.6,z=-39.8},
            
            --- 最後の階段の途中
            {x=-57.6,y=-182,z=-44}, {x=-61.9,y=-219,z=-52},
            {x=-98.6,y=-218.6,z=-60},
            ---階段の上〜暗号部屋
            {x=-98.4,y=-129.9,z=-71.9}, {x=-98,y=-47.5,z=-71.8},
        }
    },
    [152] = { --- 祭壇の間(オズトロヤ城深部)
        stone = {
            {x=-248,y=-98.9}, {x=-341.3,y=-93.3},
            {x=-338.9,y=24.87}, {x=-345.14, y=43.47}
        },
    },
    [159] = { -- ウガレピ寺院 マップ１(ユタンガから入ったとこ)
        -- 本ワープ。マップ１
        granite = {
            {x=60,y=58,z=-8}, {x=95.9,y=59}, {x=98.9,y=57},
            {x=98.5,y=41.6}, {x=101.2,y=25.2}, {x=103.3,y=22.5},
            {x=135.9,y=17.9}, {x=138.2,y=16},
            {x=142,y=-51.8},{x=143.8,y=-54.9},
            {x=174.8,y=-55.3}, {x=177.6,y=-52.7},
            {x=181.7,y=-27.5}, {x=184.3,y=-24.6},
            {x=214.8,y=-15.3}, {x=217.8,y=-12.4},
            {x=220,y=8.8},
            {x=220,y=27.7}, {a="f8touch"}, -- Granite Door
            {x=221.8,y=52.5}, {x=224.9,y=54.6},
            {x=254.8,y=64.9}, {x=257.3,y=67.5},
            {x=261.8,y=125.6}, {x=264.5,y=127.9},
            {x=268.6,y=130.4}, {x=272.5,y=134.2},
            {x=272.4,y=145}, {x=269.9,y=147.9},
            {x=264.1,y=151.5}, {x=262.2,y=154.1},
            {x=258.3,y=175.4}, {x=257.7,y=178.1},
            {x=242.4,y=179.8}, {}
        },
        --　マップ３。盗賊のナイフの場所
        graviton = {
            {x=198.9,y=301.1,z=-16}, {x=216.4,y=300},
            {a="invisi"}, {x=218.8, y=298.4},
            {x=221.7,y=276.7}, {x=226,y=272}, {x=229.6,y=267.9},
            {x=232.7,y=264.2}, {x=236.1,y=261.5},
            {x=254.6,y=261.4}, {x=258.2,y=264.7},
            {x=260.5,y=296.6}, {x=264,y=298.6},
            {x=283.2,y=301.8}, {x=293,y=311},
            {x=308.1,y=310.2}, {x=313.8,y=301.8},
            {x=333.9, y=301.4}, {x=340,y=304.1},
            {x=340,y=328.7,z=0}
        }
    },
    [182] = { -- ウォークオブエコーズ
        ornate = {
            {x=-700,y=-441,z=0.4},
            {x=-699.9,y=-305.8,z=-18},
            {a="f8touch"}
        },
    },
    [184] = { --- デルクフの塔下層
        next={ {x=460, y=-59.5, z=0}, -- 下真ん中。スタート
                {x=531, y=-75, z=0}, -- 右下1
                {x=580,y=-24, z=0}, -- 右下2
                {x=577,y=70, z=0}, -- 右上1
                {x=505,y=141, z=0}, -- 右上2
                {x=458,y=140, z=0}, -- 上真ん中。（デルクフ装置)
                {x=410,y=138, z=0}, -- 左上1
                {x=375,y=75, z=0.5}, -- 左上2。階段下
                {x=350,y=91.5,z=-5.5}, -- 階段途中
                {x=357.5,y=67.5,z=-11.5}, -- 階段途中       
                {x=373.3,y=90.3,z=-15.7}, -- 2Fスタート   
                {x=441.3,y=50.5,z=-15.9}, -- 2F真ん中  
                {x=496.6,y=48.5,z=-15.9}, -- 2F真ん中2   
                {x=510.5,y=76.6,z=-15.9}, -- 2F右上1 
                {x=551,y=103,z=-16}, -- 2F右上2 
                {x=579.7,y=96.1,z=-16}, -- 2F右上3
                {x=578.8,y=-58.5,z=-16}, -- 2F右下
                {x=531.4,y=-53.8,z=-16}, -- 階段下
                {x=531.1,y=-27.7,z=-18}, -- 階段1
                {x=504.9,y=-41.4,z=-24.5}, -- 階段2
                {x=529.1,y=-49.8,z=-30}, -- 階段3
                {x=542.3,y=-25.5,z=-32}, -- 3Fスタート
                {x=538,y=70.55,z=-32}, -- 3F右上
                {x=428.5,y=52.5,z=-32}, -- 3F真ん中
                {x=393.7,y=73.7,z=-32}, -- 3F左ワープ近く
                {x=407.5,y=88.4,z=-33.8}, -- 3F左ワープ
        },
    },
    [215] = { -- アビセアアットワ
        conf = {
            {x=-139.2,y=-180.6,z=20.3}, {x=-144.7,y=-178.8},
            {x=-146.3,y=-176.9}, {a="f8touch"}
        }
    },
    [216] = {
        conf = {
            {x=657.2,y=316.3,z=-15.1}, {x=644.1,y=317.4},
            {x=642.8,y=319.4}, {a="f8touch"}
        }
    },
    [217] = { -- アビセア、ブンカール
        conf = {
            {x=-351.3,y=699.8,z=-46.3}, {x=-339.7,y=696.7},
            {x=-318.5,y=680.9}, {x=-317.2,y=682.4},
            {a="f8touch"}
        }
    },
    [218] = {
        conf = {
            {x=430,y=320,z=0.3}, {x=424.4,y=326.9},
            {x=410.1,y=328.6}, {x=410.4,y=330},
            {a="f8touch"}
        },
    },
    [230] = { -- 南さんドリア
        -- #4
        hina = {
            {x=-164,y=11,z=-1}, {x=-188,y=45},
            {x=-203,y=92},
            {x=-274,y=98}, {a="f8touch"}, {x=-277,y=98},
            {x=-291,y=98}, {x=-292,y=103},
            {x=-293.5,y=103}, {a="f8touch"}, {x=-296.5,y=103},
            {x=-299,y=100.5}, {a="f8touch"}
        },
    },
    [236] = { -- バストゥーク港
        kaede = { -- #3からカエデの家
            {x=-126,y=11,z=-6}, {x=-130.2,y=0.2},
            {x=-120.3,y=-9.9},
            {x=-81.8,y=9.9}, {x=36.5,y=14.8},
            {x=38.5,y=43.6}, {x=41,y=51.7},
            {x=42.1,y=64.2} , {a="f8touch"}
        }
    },
    [237] = { -- バストゥーク、大工房
        -- #1
        cid = {
            {x=45,y=-18,z=-14}, {x=30.4,y=-16.6}, {x=8,y=-17},
            {x=4.6,y=-14.1}, {x=-20.1,y=-13.3}, {x=-27.3,y=-10.5},
            {x=-39.6,y=-9.6}, {x=-39.7,y=-6}, {x=-38.8,y=-1.9},
            {x=-37.1,y=-1.8}, {a="f8touch"}, {x=-33.1,y=-1.6},      
            {x=-23.2,y=-2}, {x=-16.7,y=-4.8}, {x=-14.3,y=-3.5},
            {x=-13,y=1.1}, {a="f8touch"}
        },
    },
    [238] = { -- ウィンダス水の区
        -- #1
        tosuka = {
            {x=-33,y=131.7,z=-5}, {x=-39,y=105},
            {x=-32,y=87}, {x=-23,y=87},
            {x=-23,y=90}, {a="f8touch"}, {x=-23,y=94},
            {x=-27.5,y=102.3},
        },
        -- #4
        honoi = {
            {x=4,y=-175,z=-4},
            {x=-6.4,y=-180}, {x=-40,y=-180},
            {x=-66,y=-167}, {x=-89,y=-163}, {x=-112,y=-164},
            --- トンネル
            {x=-141,y=-179}, {x=-174,y=-180}, {x=-187,y=-172},
            --- 西側
            {x=-202,y=-172}, {x=-209,y=-167},
            {x=-220,y=-143}, {x=-204,y=-134}, {x=-188,y=-130},
            --- 家の脇から入る
            {x=-182.5,y=-123}, {x=-180.5,y=-114},
            {x=-180,y=-102,z=-4.4},
            --- 階段を登る
            {x=-183,y=-102,z=-4.4}, {x=-184,y=-115,z=-10.1},
            {x=-188,y=-115}, {a="f8touch"}, {x=-191,y=-115},
            {x=-194.4,y=-115}, {x=-194.3,y=-119.5,z=-10.1}
        },
    },
    [239] = { -- ウィンダス石の区
        --- HP#1
        tower = { --- 天の塔
             {x=-73, y=124.8}, {x=-82.9, y=120.3},
            {x=-84,y=112}, {x=-79.6,y=111.8}, {x=-29,y=135.9},
            {x=-2.5,y=125.7}, {x=-0.7,y=136.8}, { x=2,y=147},
        },
        yoran = { -- ヨランオラン
            {x=-73, y=124.8}, {x=-88,y=136.5},
            {x=-94,y=149}, {x=-89.5,y=159},{x=-72.7,y=172.7},
            {x=-69.8,y=186.8}, {x=-72.9,y=188.9}, {x=-90.8,y=187.2},
            --- 玄関
            {x=-94.5,y=191}, {a="f8touch"},{x=-97,y=194},
            {x=-104.5,y=207.5}, {x=-106,y=205}, {a="f8touch"}
        },
        -- HP#3(A)
        shan = { -- シャントット
            {x=31,y=-39,z=-6.6}, {x=12.5,y=-35.1}, {x=5.9,y=-31.7},
            {x=4,y=-20}, {x=16.7,y=0.9}, {x=46.2,y=21.5},
            {x=60,y=35.7}, {x=70.8,y=51.1}, {x=90.3,y=101.8},
            {x=99.7,y=114.7}, {x=105.1,y=114.5}, {a="f8touch"},
            {x=110.73,y=113.4}, {x=119.1,y=109.6}, {x=122.2,y=109.1},
            {x=122.4,y=111.4}, {a="f8touch"}
        },
    },
    [240] = { -- ウィンダス港
        -- #3(M)
        yujuju = {
            {x=179,y=226,z=-12}, {x=199,y=216}, {x=204,y=193},
            {x=198,y=181}, {x=177.2,y=183.4}, {x=172,y=173},
            {x=173,y=159}, {x=199,y=141}
        },
    },
    [242] = { -- 天の塔
        kupipi = { {x=0,y=-22.4,z=0}, {x=-10.1,y=1.7},
                {x=-0.6,y=19.5}, {x=1.7,y=30}, 

        },
    },
    [243] = { -- ジュノ庭
        maat = {
            {x=-6,y=-1,z=3}, {x=-3,y=2.4}, {x=-1.6,y=28.6},
            {x=-3.1,y=36.2}, {x=-9.3,y=46.5}, {x=-9.3,y=64.7},
            {x=-2.5,y=76.1}, {x=2.9,y=116.7}, {x=8.1,y=119.2}
        },
        taiko = {
            {x=-6,y=-1}, {x=-3.3,y=2.5}, {x=-1, y=27.9},
            {x=-1.7,y=34}, {x=-0.3,y=68.6},
        },
        sand = { {x=-6,y=-1}, {x=2.8,y=-24.7}, -- サンド領事館
            {x=-11.33,y=-49.8}, {x=-31.2,y=-49.9} },
    },
    [244] = { -- ジュノ上層
        -- HP (E)
        marble = {
            {x=-100,y=167.6,z=0}, {x=-68.3,y=110.9},
            {x=-72.1,y=105.8}, {x=-95.9,y=92},
            {a="f8touch"}
        },
        -- HP (A)
        choco = { -- チョコボ厩舎
            {x=-52,y=15,z=1}, {x=-48.6,y=34.9},
            {x=-58,y=75.8}, {x=-42.1,y=87},
            {x=-48,y=96.4}, {x=-49.7,y=95.5,z=8.2}
        }
    },
    [245] = { -- ジュノ下層
        --HP モグハウス側
        tensho = { {x=19,y=-53}, {x=17.2,y=31.7},  -- 天晶堂
            --{x=10.3,y=25.1}, {x=6,y=18.1}, {x=4,y=8.2},
            --{x=12.6,y=-1.5}, {a="f8touch"}, {x=35.9,y=-15.4},
            --{a="f8touch"}
            {x=19,y=53,z=-1}, {x=17,y=46}, {x=19,y=33},
            {x=15,y=28}, {x=11,y=26}, {x=5,y=17}, {x=4,y=8},
            {x=12.5,y=-1}, {a="f8touch"}, {x=15,y=-3.3},
            {x=36,y=-15.5}, {a="f8touch"},
        },
        gob = { {x=-99.6,y=-183.4}, {x=-93.8,y=-150.4},
                {x=-68.7,y=-102.6},{x=-51.2,y=-113.2} },
    },
    [252] = { -- ノーグ、海賊の街
        gilga = { {x=-25.9,y=-46.2}, {x=6.9,y=-2.4},
                {x=40,y=-0.2}, {x=52.4,y=-2.4}, {x=73.4,y=-9.9},
                {x=99.4,y=-9.4}, {a="f8touch"}
                --- {x=73.3,y=-9.8}, {x=99,y=-12.5},
                --- {a="f8touch"}
        },
        oseem = { {x=-25.9,y=-46.2}, {x=-5.8,y=-20.1},
            {x=13.2,y=22.4}
        },
    },
    [253] = { -- アビセア、ウルガラン
        conf = {
            {x=-236,y=-520,z=-40}, {x=-222.6,y=-522.3},
            {x=-222.2,y=-524.9}, {a="f8touch"}
        },
    },
    [254] = { -- アビセア、グロウベルグ
        conf = {
            {x=-552,y=-760,z=32.4}, {x=-528.2,y=-772.7},
            {x=-528.9,y=-776.1}, {a="f8touch"}
        },
    },
    [256] = { -- 西アドゥリン
        pio = { {x=-105.5,y=-13.5}, {x=-101,y=-11},
            {x=-96.2,y=15.5}, {x=-88.8,y=15}
        },
        levil = { {x=-105.5,y=-13.5}, {x=-101,y=-11},
            {x=-97,y=16}, {x=-88.4,y=13}, {a="f8touch"}
        },
        piowp =  {{x=-88.8,y=15},  {x=-96.2,y=15.5},
            {x=-102.4,y=-11.13}, {x=-107.3,y=-11.1,a="f8touch"}, 
        },          
        cou = { {x=4.9,y=-4.7,z=0}, {x=-10,y=6,z=-0.1}, {x=-32.5,y=28.7,z=0.7},
                {x=-31.8,y=30}, {x=-29.1,y=35.1},
                {x=-28.6,y=35.8} ,{a="f8touch"}
        },
        couwp = { {x=-30,y=33.7}, {x=-32.5,y=28.7,z=0.7}, {x=-10,y=6,z=-0.1},
                {x=1.3,y=-2.4}, {x=0.9,y=-2.3}, -- {x=2.0,y=-2.9},
                {x=4,y=-4.5,z=0}, {a="f8touch"}
            },
        mum = {
            {x=-21.9,y=-81.9,z=-0.2}, {x=-15.7,y=-89.6},
            {x=-16,y=-92.9}, {x=-32.7,y=-110.3}, {x=-37.8,y=-108},
            {x=-39.8,y=-106.5}
            -- {x=-39.8,y=-106.5,a="f8touch"}
        },
        mumwp = {
            {x=-39.8,y=-106.5},{x=-37.8,y=-108},
            {x=-32.7,y=-110.3}, {x=-16,y=-92.9},
            {x=-15.7,y=-89.6}, {x=-21.9,y=-81.9,z=-0.2},
            {a="f8touch"}
        },
        tomato = { -- レンタルハウスから水道トマトの場所
            {x=-1.4,y=-142}, {x=11.1,y=-137.8}, {x=37.3,y=-158},
            {x=77.21,y=-181.4}, {x=81,y=-180.1}, {x=81.7,y=-151.4},
            {x=80.6,y=-148.7}, {x=78.9,y=-148.5}, {}
        },
        f5rala = { -- F5からララ水道
            {x=51,y=126.3}, {x=29.8,y=102.7}, {x=-41.3,y=102.8},
            {x=-43,y=121}, {x=-75,y=121.5}, {x=-74.6,y=118.9}, {}
        },
        -- ビッグブリッジ前
        k8rala = {
            {x=174.8,y=-35.8,z=3.8}, {x=141.4,y=-2.3,z=4},
            {x=141.9,y=37.2,z=12}, {x=145.4,y=37.1,z=12},
            {x=145.1,y=4.8,z=20}, {x=142,y=4.4,z=20}, {}
        },
    },
    [257] = { -- 東アドゥリン
        -- pck
        sct = { -- PCK
            {x=-77.9,y=-63.9,z=-0.2}, {x=-109,y=-56.8},
            {x=-111.6,y=-54.2}, {x=-112.7,y=-48.9}, {a="f8touch"}
        },
        sctwp = { -- PCK
            {x=-97.4,y=-51}, {x=-112.7,y=-48.9},
            {x=-111.6,y=-54.2},
            {x=-109,y=-56.8}, {x=-77.9,y=-63.9},
            {a="f8touch"}
        },
        f7rala = {
            {x=-101.3,y=-10.7,z=-0.1}, {x=-111.8,y=-1.6,z=0},
            {x=-123.5,y=4.2,z=0}, {x=-126.2,y=60.1,z=0},
            {x=-129,y=60.2,z=0.1}, {x=-130,y=57.3,z=0.9},
            {x=-129.7,y=28.9,z=8.1}, {x=-126.5,y=28.4,z=8.1},
            {}
        },
    },
    [258] = { -- ララ水道
        -- 西アドゥリンのレンタルハウス
        tomato = {  -- トマトの場所
            {x=-268,y=-380.8},{x=-291.4,y=-378.6}, {x=-298.8,y=-371.3},
            {x=-298.6,y=-348.8}, {x=-293.9,y=-346.3}, {x=-293.6,y=-333.9},
            {x=-301.4,y=-331}, {x=-302.2,y=-321.4}, {x=-315.3,y=-318.6,a="f8touch"}
        },
        -- 西アドゥリンビッグブリッジ近く。
        xxx = { -- 扉を出て東へ。真ん中で止まる（未完成）
            {x=-188,y=60.5,z=-5.8}, {x=-211.4,y=59.1}, {a="sneak"},
            {x=-218.9,y=52.4},{x=-219.7,y=44.3},
            {a="esc"}, {a="touch"}, {a="touch"}, {x=-219.9,y=36.5},
            {x=-218.8,y=20.7} ,{x=-92.2,y=20},
        },
        water = { -- 水園の決闘場
            {x=150,y=139.8,z=-5.8}, {x=171.6,y=139.2},  {a="sneak"},
            {x=179.2,y=131.2},{x=179.7,y=124.5},
            {a="esc"}, {a="touch"}, {a="touch"},
            {x=180.8,y=101.1}, {x=259,y=98.6}, {x=260,y=62},
            {a="f8touch"}
        },
        slug = { -- ワークス、スラッグ
            {x=150,y=139.8,z=-5.8}, {x=171.6,y=139.2},
            {a="esc"}, {a="sneak"},
            {x=179.2,y=131.2},{x=179.7,y=124.5},
            {a="esc"}, {a="touch"}, {a="touch"}, {x=180.8,y=101.1},
            {x=292.2,y=99.7}, {x=299.3,y=92.3},
            {x=299,y=-52.5}, {x=292.3,y=-59.4},
            {x=228.2,y=-60.3}, {x=220.8,y=-67.5}, {x=220.9,y=-119}
        },
    },
    [261] = { -- ケイザック古戦場
        -- #2 から
        ergon = { -- エルゴンローカス
            {x=-42,y=155,z=0}, {x=-33,y=167}, {a="mount"},
            {x=-24.6,y=179.5}, {x=-2.6,y=190.8},
            {x=12.8,y=188.9}, {x=23.5,y=148.4}, {x=32.9,y=130.9},
            {x=53,y=120}, {x=85.9,y=74.7}, {a="dismount"}
        },
        -- #3 から
        sih = {
            {x=-442,y=-247,z=0}, {x=-433.1,y=-251.6},
            {a="mount"}, {x=-416.8,y=-267}, {x=-409,y=-273.4},
            {x=-410.8,y=-293.6}, {x=-418.4,y=-311.8}, {x=-422.2,y=-330.1},
            {x=-430.6,y=-347.7}, {x=-460.4,y=-359.3}, {x=-469.8,y=-357.2},
            {x=-485.8,y=-348.9}, {x=-497.7,y=-338.1}, {x=-527.4,y=-339.4},
            {x=-536.3,y=-333.8}, {x=-540.4,y=-329.6}, {x=-539.5,y=-316.7},
            {}
        },
    },
    [262] = { -- エヌティエル水林
        -- Fステ
        sih = { -- シィの門
            {x=398.1,y=279.1,z=-2}, {x=375,y=285}, {a="mount"},
            {x=352,y=291.7}, {x=341.4,y=298.4},
            {x=311,y=302.8}, {x=303.4,y=309.4}, {x=300.9,y=339.8},
            {x=306.4,y=352.4}, {x=329.8,y=411.2}, {x=344.2,y=418.4},
            {x=348.9,y=427.4}, {x=352.4,y=447.2}, {x=363.3,y=457.8},
            {x=376,y=461.9}, {}
        },
        raive = { -- レイヴ
            {x=398.1,y=279.1,z=-2}, {x=401,y=270}, {a="mount"},
            {x=412.7,y=229}, {x=419.3,y=217.8}, {x=419,y=197},
            {x=411.5,y=183.5}, {x=378,y=177}, {x=362.3,y=162.9},
        },
        ergon = { --エルゴンローカス
            {x=398.1,y=279.1,z=-2}, {x=401,y=270}, {a="mount"},
            {x=412.7,y=229}, {x=419.3,y=217.8}, {x=419,y=197},
            {x=411.5,y=183.5}, {x=378,y=177}, {x=342.7,y=141.5},
            {x=342.4,y=114}, {x=348,y=105}, {x=380.4,y=98},
            {x=399.4,y=91.2}, {x=417,8,y=98.8}, {x=424.5,y=129.7},
            {x=430,y=137}, {x=453.7,y=138.9}, {x=463.7,y=141},
            {}
        },
    },
    [263] = { -- ヨルシア森林
        --- #1
        wave = { -- wavering flux 怪霊君 (アシュラック)
            {x=-40.5,y=296.4}, {x=-51.9,y=312.2}, {a="mount"},
            {x=-60.9,y=330.9}, {x=-73.6,y=337.6}, {x=-95,y=344.8},
            {x=-92.8,y=356.4}, {x=-91.2,y=377.2}, {x=-59.4,y=381.6},
            {x=-37.3,y=376.6}, {x=-24.2,y=383.4}, {x=-18, y=399},
            {x=-12.1,y=410.8}, {x=-13,y=420.7}, {x=18.7,y=421.4},
            {x=23.2,y=412}, {x=20.8,y=391.3}, {x=42.7,y=371.9},
            {a="dismount"}
        },
        ergon = { -- Ergon 又は Pellucid Afflusion、澄んだ水 (女王種)
            {x=-40.5,y=296.4}, {x=-45,y=305}, {a="mount"},  {x=-49.5,y=315.8},
            {x=-63.6,y=333.2},{x=-92.5,y=343.7},{x=-93.3,y=372.8}, {x=-83.8,y=378.3},
            {x=-59,y=380},{x=-56.7,y=403.7}, {x=-52.8,y=418.4}, {x=-60.2,y=423.5},
            {x=-94.4,y=419}, {x=-134,y=432.1}, {x=-169.9,y=389.9},
            {a="dismount"},
        },
        raive1 = { -- レイアレイブ
            {x=-40.5,y=296.4}, {x=-49.5,y=315.8}, {x=-63.6,y=333.2}, {x=-92.5,y=343.7},
            {x=-93.3,y=372.8}, {x=-83.8,y=378.3}, {x=-26,y=387.2}, {x=-19.1,y=415.9},
            {x=-5.7,y=420.5}, --- 途中まで
        }
    },
    [265] = { -- モリマー
        -- #1
        ergon = {
            {x=368,y=37.5,z=-16}, {x=363.7,y=51.2}, {a="mount"},
            {x=361,y=68.4}, {x=335,y=221.4}, {x=330,y=230.6},
            {x=328.6,y=251.5}, {x=338.4,y=265}, {x=355.7,y=271.6},
            {x=373.7,y=269.5}, {x=391.8,y=262.7}, {x=407.8,y=262},
            {x=429.1,y=271.2}, {x=483.8,y=325.4}, {a="dismount"}
        },
    },
    [266] = { -- マリミア
        woh = { -- ウォーの門へ
            {x=-326,y=201.1,z=-40}, {x=-329,y=184}, {a="mount"},
            {x=-330.2,y=182.4}, {x=-337.5,y=170.3},
            {x=-348.5,y=166.7}, {x=-384.5,y=161},
            {x=-414.4,y=169.9}, {x=-418,y=179.1},
            {x=-421.9,y=205.3}, {x=-423.5,y=223.6}, 
            {x=-438.3,y=234.7}, {x=-455.3,y=255.7},
            -- 洞窟の中
            {x=-453.3,y=268.1}, {x=-468.9,y=299.5}, {x=-494.93,y=301.5},
            {x=-497.5,y=305}, -- {x=-500,y=311.9}, {}
            {x=-500,y=319,z=-40}, {}
            --- {x=-500,y=320}, {}
        },
    },
    [267] = { -- カミール
        -- #F から
        woh = { -- ウォーの門
            {x=439.4,y=-272.6, z=63}, {x=432.4,y=-284.9}, {a="mount"},
            {x=421.3,y=-291.9}, {x=399.4,y=-318.3}, {x=383.6,y=-341.6},
            {x=381,y=-364.7}, {x=384.4,y=-370.4}, {x=388.9,y=-375.3},
            {x=389.2,y=-381}, {x=387.6,y=-389.8}, {x=395.7,y=-399.5},
            {x=410.2,y=-411.6}, {x=414.9,y=-425.2}, {x=427.5,y=-429},
            {x=450.3,y=-457}, {x=459.3,y=-460.8}, 
            --- 洞窟入った
            {x=481.5,y=-460.5}, {x=497.9,y=-464.9},
            {x=497.9,y=-484.9}, {}
        },
        ergon = {
            {x=439.4,y=-272.6, z=63}, {x=433.1,y=-279.8},
            {x=426,y=-276.5}, {x=417.6,y=-274.5}, {a="mount"},
            {x=395.4,y=-275.7}, {x=376.3,y=-263.6},
            {x=352.3,y=-259.4}, {x=342.8,y=-270.9}, {x=341.9,y=-278.3},
            {x=339.2,y=-291.9}, {x=329.7,y=-298.7}, {x=295.3,y=-301.1},
            --- 洞窟を出たとこ
            {x=286,y=-283.8}, {x=280.2,y=-255.7}, {x=290.3,y=-226.5},
            {x=301.9,y=-214.6}, {x=303.7,y=-207.8}, {x=299.7,y=-185.4},
            {x=295.9,y=-181.5}, {x=269.2,y=-184.5}, {x=260.7,y=-177.7},
            {x=245.1,y=-160.8},
            --- レイブ壁の手前
            {x=258.6,y=-143}, {x=294.3,y=-140.5},{x=298.8,y=-135.6},
            {x=294.7,y=-109.9}, {x=301.7,y=-101.4}, {x=310.8,y=-91}, 
            {x=312.5,y=-75.9}, {x=299.6,y=-67.2},
            --- 洞窟
            {x=299,y=-29.7}, {x=310.8,y=-21.2}, {x=330.4,y=-20.6},
            {x=338.3,y=-8.4}, {x=341.4,y=22.6}, {x=326.6,y=36.3},
            {a="dismount"}, {x=321.5,y=47.6}
        },
        -- #2から
        craw = { -- Crawling Cave
            {x=8.2,y=-283,z=43}, {x=-2.4,y=-284},{a="mount"},
            {x=-3,y=-285.6}, {x=-18.3,y=-256.8},
            {x=-21.7,y=-231.6}, {x=-29.4,y=-224.6}, {x=-27,y=-208},
            {x=-38.2,y=-203.9}, {x=-48.5,y=-213.5}, {x=-62.9,y=-225.8},
            {x=-63.6,y=-233.7}, {x=-63.4,y=-260}, {x=-90.6,y=-264.5},
            {x=-100.9,y=-255.9}, {x=-107.6,y=-250.4}, {x=-131.2,y=-234.4},
            -- 洞窟に入る
            {x=-133,y=-228.4}, {x=-130.2,y=-219.5}, {x=-132.9,y=-214.4},
            {x=-138.9,y=-207.5}, {x=-143.2,y=-181.2}, {x=-156.6,y=-167.5},
            {x=-181.8,y=-177}, {x=-199.8,y=-179.4},
            --- 洞窟を抜けて崖を降りた先
            {x=-206.8,y=-179.4}, {x=-225.5,y=-182}, {x=-235.9,y=-190.8},
            {x=-270.9,y=-200.8}, {x=-291.4,y=-213.9}, {x=-294.7,y=-226.3},
            {x=-309,y=-231.2}, {x=-314.4,y=-242.5}, {x=-312.7,y=-281.4},
            {x=-305.7,y=-305.7}, {x=-295,y=-308.7}, 
            --- ここで分岐
            {x=-289.8,y=-316.3}, {x=-289,y=-322.5},{x=-293.7,y=-345.7},
            {x=-307.6,y=-349.8}, {x=-335,y=-379.2} ,{x=-341,y=-379.4},
            {a="dismount"}, {x=-346.3,y=-379.7}, {a="f8touch"}
        },
        holl = {
            {x=8.2,y=-283,z=43},{x=2.6,y=-284.3}, 
            {a="mount"}, {x=-3,y=-285.6}, {x=-18.3,y=-256.8},
            {x=-21.7,y=-231.6}, {x=-29.4,y=-224.6}, {x=-27,y=-208},
            {x=-38.2,y=-203.9}, {x=-48.5,y=-213.5}, {x=-62.9,y=-225.8},
            {x=-63.6,y=-233.7}, {x=-63.4,y=-260}, {x=-90.6,y=-264.5},
            {x=-100.9,y=-255.9}, {x=-107.6,y=-250.4}, {x=-131.2,y=-234.4},
            -- 洞窟に入る
            {x=-133,y=-228.4}, {x=-130.2,y=-219.5}, {x=-132.9,y=-214.4},
            {x=-138.9,y=-207.5}, {x=-143.2,y=-181.2}, {x=-156.6,y=-167.5},
            {x=-181.8,y=-177}, {x=-199.8,y=-179.4},
            --- 洞窟を抜けて崖を降りた先
            {x=-206.8,y=-179.4}, {x=-225.5,y=-182}, {x=-235.9,y=-190.8},
            {x=-270.9,y=-200.8}, {x=-291.4,y=-213.9}, {x=-294.7,y=-226.3},
            {x=-309,y=-231.2}, {x=-314.4,y=-242.5}, {x=-312.7,y=-281.4},
            {x=-305.7,y=-305.7},{x=-295,y=-308.7},
            --- ここで分岐 (y=-344.4 まずいかも？)
            {x=-265,y=-332.1}, {x=-251.6,y=-344.4}, {x=-229.7,y=-335.6},
            {x=-211.6,y=-352.2}, {x=-201,y=-379.6}, {x=-202.8,y=-406.6},
            {x=-206.8,y=-443.4}, {x=-211.7,y=-445.3}, {a="dismount"}
        },
        craw2holl = {
            {x=-346.3,y=-379.7}, {a="mount"},
            {x=-335,y=-379.2}, {x=-307.6,y=-349.8},
            {x=-293.7,y=-345.7}, {x=-289,y=-322.5}, {x=-289.8,y=-316.3},
            --- 分岐点
            {x=-265,y=-332.1},{x=-251.6,y=-344.4},
            {x=-229.7,y=-335.6}, {x=-211.6,y=-352.2},
            {x=-201,y=-379.6}, {x=-202.8,y=-406.6},
            {x=-206.8,y=-443.4}, {a="dismount"},
            {x=-212.2,y=-445.3,z=40}, {a="f8touch"},
            {a="wait"}, {a="enter"}
        },
        holl2craw = {
            {x=-206.8,y=-443.4}, {a="mount"},
            {x=-202.8,y=-406.6}, {x=-201,y=-379.6},{x=-211.6,y=-352.2},
            {x=-229.7,y=-335.6}, {x=-251.6,y=-344.4},{x=-265,y=-332.1},
            --- 分岐点
            {x=-289.8,y=-316.3}, {x=-289,y=-322.5},{x=-293.7,y=-345.7},
            {x=-307.6,y=-349.8}, {x=-335,y=-379.2}, {x=-341, y=-379.5},
            {a="dismount"}, {x=-346.3,y=-379.7}, {a="f8touch"},
        },
        -- #3 から
        alpine = { -- 山頂
            {x=9.2,y=162.8,z=23}, {x=13,y=172.5},
            {a="mount"}, {x=16.8,y=182.3}, {x=19.6,y=198.1},
            --- 崖から降りる
            {x=18.9,y=221.8}, {x=31.3,y=238.1}, {x=25.7,y=251.1},
            {x=14,y=255.1}, {x=9.6,y=269.8}, 
            --- 洞窟に入る
            {x=-20.6,y=295.3}, {x=-19.8,y=329.2}, {x=-29.9,y=336.7},
            {x=-48.6,y=340.3}, {x=-57.7,y=350.1}, {x=-60.5,y=368.5},
            {x=-49.2,y=377.7}, {x=-14.1,y=380.6}, {x=-4.4,y=390.5},
            {x=21.6,y=411.4}, {x=31.4,y=427.4}, {x=30.2,y=444.7},
            {x=23.6,y=451.7}, {x=15,y=454.2}, {x=9.3,y=468.5},
            {x=-10,y=486.4}, {a="dismount"}, {x=-10.8,y=486.4},
            {a="f8touch"}, {a="wait"}, {a="enter"}
        },
    },
    [268] = { -- シィの門
        -- ケイザック古戦場出口、
        d5sir = { -- D5からシルダスへ
            {x=-261.1,y=39,z=-30}, {x=-259.1,y=32.9}, {a="insne"},
            {x=-254.1,y=26.1}, {x=-249.9,y=24.1}, {x=-243,y=21.5},
            {x=-233,y=20.4}, {x=-223.7,y=14.3}, {x=-219.5,y=5.6},
            {x=-218.7,y=-6.3}, {x=-222,y=-13}, {x=-230.7,y=-20.4},
            {x=-242.2,y=-19.6}, {x=-248,y=-21.3}, {x=-254.8,y=-26.8},
            {x=-258.9,y=-36.6,z=-10.6}, {x=-257.4,y=-57.3,z=-10},
            {x=-248.6,y=-77.1,z=-10.2}, {x=-247.2,y=-88.4,z=-10.2},
            {x=-251.2,y=-96.8,z=-10.2}, {x=-297.7,y=-99.5,z=-12.1},
            {x=-301.5,y=-95.1,z=-12}, {x=-303.5,y=-71.5,z=-13.1},
            {x=-313.7,y=-61.6,z=-18}, {x=-336.7,y=-60.8,z=-20.8},
            {x=-395.9,y=-59.6}, {x=-406.7,y=-59.6}, {x=-432.4,y=-60.3},
            {x=-450,y=-56.4}, {x=-460.9,y=-43.4}, {x=-459.6,y=-26.8},
            {x=-462.8,y=-22.2}, {x=-488.4,y=-17.3}, {x=-498,y=-7.5},
            {x=-501.5,y=-1.5,z=-39.9}, {}
        },
        -- エヌティエル水林出口、東側
        ergon = { -- エルゴンローカス
            {x=-159.6,y=-421,z=-30},  {x=-154,y=-420},
            {a="insne"}, {x=-150.8,y=-419.1},
            {x=-140.9,y=-408.3}, {x=-139.6,y=-390.9}, {x=-147.8,y=-382.2},
            {x=-154.5,y=-380.9}, {x=-160,y=-380.9}, {x=-166.9,y=-379.8},
            {x=-174.5,y=-373.9}, {x=-178.9,y=-363}, {x=-178.6,y=-345.4},
            {x=-172.3,y=-332.7}, {x=-154,y=-332.8}, {x=-146,y=-334.1},
            {x=-124,y=-339.4}, {x=-108,y=-345.5}, {x=-102.8,y=-352.3},
            {x=-96.9,y=-373}, {x=-71.9,y=-380.7}, {x=-60.7,y=-395.3},
            {x=-60.3,y=-410.3}, {x=-61.1,y=-417.2}, {x=-57.1,y=-419.5},
            {x=-48.4,y=-420.5}, {x=-18,y=-425.8}, {x=12.8,y=-438.2},
            {a="rmstatus"}, {a="wait"}, {a="f8touch"},
            {a="wait"}, {a="enter"}, {a="wait"}, {a="enter"}
        },
    },
    [270] = { -- シルダス洞窟
        -- WPワープ
        ergon = { -- アドゥリンMの場所。コロナイズレイブの手前
            {x=70,y=579,z=29.2}, {x=89,y=578}, {a="insne"},
            {x=104.8,y=571.8}, {x=110.8,y=556.9},
            {x=96.4,y=502}, {x=63.8,y=497}, {x=50.6,y=462.6},
            {x=12.9,y=450}, {x=6.0, y=418.2}, {x=30,y=324},
            {x=26.1,y=307.1}, {x=-3.9,y=300.3}, {x=-71.4,y=316},
            {x=-94.4,y=303.7}, {x=-104,y=264.9}, {x=-136.9,y=256.6},
            {x=-139,y=232.4}, {x=-117.2,y=219.8}, {x=-101.9,y=217},
            {x=-100.3,y=151.7}, {x=-139.9,y=129.2},
            {x=-136.1,y=111},  {x=-125.8,y=101.9}, {x=-102.3,y=100.7},
            {x=-90.2,y=44.9}, {x=-95,y=29},
        },
        -- シィの門から
        wave = { -- waveling flux 変妖君（ドクマク)
            {x=421.5,y=-279.5,z=40}, {x=424,y=-257.7}, {a="insne"},
            {x=413.5,y=-184.8}, {x=392.3,y=-176.3}, {x=386.1,y=-163.4},
            {x=385.8,y=-147.2}, {x=393.2,y=-140.8}, {x=418.2,y=-134.8},
            {x=430.8,y=-126.1}, {x=421.3,y=-90.5}, {x=420.6,y=-69.5},
            {x=419.2,y=-60.2}, {x=410.9,y=-58.8}, {x=393.8,y=-58.9},
            {x=364.8,y=-50.2}, {x=352.1,y=-50.5}, {x=344.8,y=-59.8},
            {x=334.8,y=-99.3}, {x=328.4,y=-110.5}, {x=312.4,y=-109.3},
            {x=301.3,y=-90.4}, {x=300.7,y=-79.3}, {a="rmstatus"},
            {x=300.3,y=-71.7}, {a="f8touch"}
       },
    },
    [274] = { -- カザナル外郭
        pec = { --　珍妙なモンスター
            {x=-148,y=27,z=-170}, {x=-98.8,y=-7.9,z=-176.3},
            {x=-38.4,y=-19.4,z=-179.3}  
        },
    },
    [277] = {  -- カザナル宮天守
        omi = { -- Ominous Postern (最奥)
            {x=70,y=20,z=-30}, {a="f8touch"}, {a="enter"}, {x=80,y=20},
            {x=97.8,y=19.8}, {x=101.5,y=58.4}, {x=218.4,y=58.3,z=15},
            {x=218.3,y=22,z=25}, {x=121.5,y=20.1,z=39.2},
            {a="f8toucb"}
        }
    },
    [281] = { -- リファーリア
        aged = { -- Aged Stump
            {x=4.6,y=8.2,z=-0.3}, {x=-1.7,y=9.1},
            {x=-25.7,y=32}, {a="f8touch"}
        },
    },
}

function targetPos(t)
    local mob = windower.ffxi.get_mob_by_target(t)
    if mob == nil then
        return nil
    end
    return {x=mob.x, y=mob.y, z=mob.z}
end
M.targetPos = targetPos

function targetDistance(t)
    local mob = windower.ffxi.get_mob_by_target(t)
    if mob == nil then
        return nil
    end
    return mob.distance
end
M.targetDistance = targetDistance


function currentPos()
    return targetPos("me")
end
M.currentPos = currentPos

function distance2(pos1, pos2)
    local dx = pos2.x - pos1.x
    local dy = pos2.y - pos1.y
    return dx * dx + dy * dy
end

function distance(pos1, pos2)
    if pos1 == nil or pos2 == nil then
        return 99999
    end
    if pos1.z ~= nil and pos2.z ~= nil then
        local dz = pos2.z - pos1.z
        if math.abs(dz) > 10 then
            return 99999
        end
    end
    return math.sqrt(distance2(pos1, pos2))
end
M.distance = distance

function nearest_idx(pos, posTable)
    local near_idx = nil
    local near_dis = 99999
    for i, p in ipairs(posTable) do
        if p.x ~= nil then
            d = distance(pos, p)
            if d < near_dis then
                near_idx = i
                near_dis = d
            end
        end
    end
    return near_idx
end

-- 指定した方向に向く
local turnTo = function(pos)
    local me = currentPos()
    local dx = pos.x - me.x
    local dy = pos.y - me.y
    --- atan2 のままだと右を向くので、90度の補正
    local dir = math.atan2(dx, dy) - 3.14/2
    windower.ffxi.turn(dir)
end
M.turnTo = turnTo

-- 視界を前を向ける
local lookForward = function()
    local push_numpad5 = 'setkey numpad5 down; wait 0.1; setkey numpad5 up'
    windower.send_command(push_numpad5..'; wait 0.5; '..push_numpad5)
end
M.lookForward = lookForward

--
-- moveTo
--

local moveToRunning = false

function stop()
---    print("moveToRunning = false")
    moveToRunning = false
end
M.stop = stop

function getRouteTable(zone)
    local t = aczone.zoneTable[zone]
    if t ~= nil and t.routes ~= nil then
	return t.routes
    end
    return automoveRouteTable[zone]
end

function moveTo(route)
    local zone_id = windower.ffxi.get_info().zone
    local pos = currentPos()
    local r1List = {}  -- 各routeの一個目をリスト化
    local r1ListName = {}
    local routeTable = getRouteTable(zone_id)
    if routeTable == nil then
	print("routeTable == nil")
	return
    end
    for i, p in ipairs(route) do
        if p.r ~= nil then
            print("p.r="..(p.r))
            local r = routeTable[p.r]
            print("r", r)
            table[p.r] = r[1]
            table.insert(r1List, r[1])
            table.insert(r1ListName, p.r)
        end
    end
    print("rList", rList)
    if #r1List > 0 then
        local idx = nearest_idx(pos, r1List)
        local name = r1ListName[idx]
        local r = routeTable[name]
        print(idx, name, r)
        moveTo(r)
    end
    moveToRunning = true
    print("moveFrom", math.round(pos.x, 2), math.round(pos.y, 2))
    local start_idx = nearest_idx(pos, route)
--    print('start_idx', start_idx)
    if distance(pos, route[start_idx]) > 64 then
        print("not starting position")
        stop()
        return false
    end
--    print("#route", #route)
    for i, p in ipairs(route) do
        if i < start_idx then
            print("skip route idx:", i)
        else
            if p.x == nil and p.a == nil then
                windower.ffxi.run(true)
                break
            end
            if p.a == "mount" then
                windower.send_command('input /mount ラプトル')
                coroutine.sleep(2.0)
            end
            if p.a == "dismount" then
                windower.send_command('input /dismount')
                coroutine.sleep(2.0)
            end
            if p.a == "insne" then
                print("insne")
                windower.ffxi.run(false)
                coroutine.sleep(1)
                windower.send_command('input /ma スニーク <me>; wait 7.5; input /ma インビジ <me>')
                coroutine.sleep(16)
            end
            if p.a == "sneak" then
                print("sneak")
                windower.ffxi.run(false)
                coroutine.sleep(1)
                windower.send_command('input /ma スニーク <me>')
                coroutine.sleep(7)
            end
            if p.a == "invisi" then
                print("invisi")
                windower.ffxi.run(false)
                coroutine.sleep(1)
                windower.send_command('input /ma インビジ <me>')
                coroutine.sleep(7)
            end
            if p.a == "invisi_cancel" then
                print("invisi cancel")
                windower.ffxi.run(false)
                coroutine.sleep(1)
                windower.ffxi.cancel_buff(69) -- インビジキャンセル
            end
            if p.x ~= nil then
                print("moving", i, p.x, p.y)
                while (distance(currentPos(), p) > 0.5 and moveToRunning == true) do
                    if distance(currentPos(), p) > 6468 and false then
                        print("not near position")
                        stop()
                        return
                    end
                    turnTo(p)
                    pos = currentPos()
                    windower.ffxi.run(p.x - pos.x, p.y - pos.y)
                    coroutine.sleep(0.1)
                end
                windower.ffxi.run(false)
                local t = math.random(0,1)/5
                coroutine.sleep(t)
            end
            if p.t ~= nil then
                windower.send_command('input /target '..p.t)
                coroutine.sleep(0.5)
            end
            if p.a == "f8touch" or p.a == "opendoor" then
                pushKeys({"escape", "f8", "enter"})
                coroutine.sleep(1.0)
                touch = true
            end
            if p.a == "esc" then
                pushKeys({"escape"})
                coroutine.sleep(1.0)
            end
            if p.a == "touch" then
                pushKeys({"enter"})
                coroutine.sleep(1.0)
            end
            if p.a == "rmstatus" then
                pushKeys({"escape", "numpad+", "numpad+", "enter"})
                coroutine.sleep(2.0)
            end
            if p.a == "enter" then
                pushKeys({"enter"})
                coroutine.sleep(1.0)
            end
            if p.a == "wait" then
                coroutine.sleep(1.0)
            end
            if p.a == "up" then
                pushKeys({"up"})
                coroutine.sleep(1.0)
            end
            if p.a == "down" then
                pushKeys({"down"})
                coroutine.sleep(1.0)
            end
        end
    end
    return true
end
M.moveTo = moveTo

function autoMoveTo(zone_id, dest, reverse)
    local routeTable = getRouteTable(zone_id)
    if dest == nil then
        if routeTable == nil then
            print("not defined zone route", zone_id)
        else
            for i, dest in pairs(routeTable) do
                printChat(i)
            end
        end
    else
        route = routeTable[dest]
        if reverse == true then
            route = array_reverse(route)
        end
        moveTo(route)
    end
end
M.autoMoveTo = autoMoveTo

return M

